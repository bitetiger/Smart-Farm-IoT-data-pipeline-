# **validate_lambda 구현**

### **2022.07.29 커밋**
- S3에서 데이터 수집 코드
- S3 데이터의 key 값 로그로 받아오기
- Serverless Framework로 배포 자동화
---
### **2022.08.01 커밋**
- **1차 커밋**
    - `pandas` 모듈을 Lambda에 추가 (Lambda Layer)
        - AWSDataWrangler-Python38 Layer 사용
    - `pandas` 모듈 사용하여 `parquet` 파일 읽어오기
        - 실패..

- **2차 커밋**
    - io 모듈을 사용하여 `parquet` 파일 읽기
    - `.head(1)` 함수를 사용하여 첫번째 줄 불러오기
---
### **2022.08.02 커밋**
- **1차 커밋**
    - 비정상적 데이터 정제 기준 추가
        - `pyarrow.parquet` 모듈 사용
- **2차 커밋**
    - 데이터 정제 기준 수정
        - 이전 코드에서 오류 -> `pandas` 모듈을 사용하여 다시 수정
- **3차 커밋**
    - 데이터 정제 기준 수정
        - 정삭적인 데이터를 제외 해야하는데, 모든 데이터를 들고 옴.
        - 비정상적인 데이터만 가져오도록 기준 수정
    - 비정상적인 데이터 모음
        - `pandas.concat` 함수를 사용하여 데이터 모으기
    - 데이터 모음을 `parquet` 파일로 변환
        - `pandas.DataFrame.to_parquet` 함수 사용
---
### **2022.08.03 커밋**
- **1차 커밋**
    - Target S3로 비정상적 데이터 Upload
        - Upload 할 file 이름을 `time` 모듈을 사용하여 고유한 이름으로 지정
        - `parquet` 파일을 S3로 저장
    - 비정상적 데이터를 한 파일로 모을 때의 중복 데이터 제거 
- **2차 커밋**
    - `time.localtime()` 함수를 사용하여 지정했더니 Lambda로 넘어가면서 시간대가 바뀌는 문제
        - -> `datatime` 모듈로 시간대 지정
    - Lambda 내에 환경변수 설정
    - `parquet` 파일이 Lambda 내에 저장될 경로 설정
        - `os` 모듈 사용
    - `boto3`의 `upload_fileobj()` 함수를 사용하니, obj를 불러오는 과정에서 문제 발생
        - -> `upload_file()` 함수로 변경, 파일의 경로와 S3로 저장할 이름 설정
---
### **2022.08.04 커밋**
- **1차 커밋**
    - Discord Webhook 구현
        - HTTP 요청 형식 사용
        - `device_id` 별로 데이터 구별
        - `err_code == "1"` 인 데이터는 메시지 포맷 구별
            - `"센서가 고장났어요"` 메시지 전송
        - `err_code != "1"` 인 데이터
            - `"이상 데이터가 감지됨"` 과 함께 같은 시각의 데이터 모두 전송
---
- **2차 커밋**
    - 메시지 포맷 수정
        - 가독성을 위해 데이터 사이에 구별 선 추가
    - `error_code == "1"` 인 데이터를 식별 못하는 오류
        - `error_code` 의 데이터 타입이 `String` 이었음
    - 중복 코드 수정
---
- **3차 커밋**
    - `error_code == "1"` 인 데이터와 아닌 데이터를 구분하여 메세지를 보내기 위해 코드 수정
---
- **4차 커밋**
    - `try:` 안에 속한 불필요한 코드 밖으로 꺼내기
    - `error_code == "1"` 인 데이터를 구분하여 메시지 보내기
        - `payload` 와 `header` 를 구별하여 선언
---
- **5차 커밋**
    - Syntax error 수정